<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Weekly Work: Kernel Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="weeklyWorkKernels_files/libs/clipboard/clipboard.min.js"></script>
<script src="weeklyWorkKernels_files/libs/quarto-html/quarto.js"></script>
<script src="weeklyWorkKernels_files/libs/quarto-html/popper.min.js"></script>
<script src="weeklyWorkKernels_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="weeklyWorkKernels_files/libs/quarto-html/anchor.min.js"></script>
<link href="weeklyWorkKernels_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="weeklyWorkKernels_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="weeklyWorkKernels_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="weeklyWorkKernels_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="weeklyWorkKernels_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Weekly Work: Kernel Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="week-3" class="level2">
<h2 class="anchored" data-anchor-id="week-3">Week 3</h2>
<p>Due to the timing issues, we continue with the plan of comparing kernels. For a simple analysis we look at the first layer of each model and output all of itâ€™s kernels and compare for the different models based on differing sizes of dataset.</p>
<div id="fig-kernelAnalysisInitial" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kernelAnalysisInitial-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelAnalysisInitial" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-week3data250kernel0" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week3data250kernel0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week3/250Filter0kernel0.png" class="img-fluid figure-img" data-ref-parent="fig-kernelAnalysisInitial">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week3data250kernel0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) 250 snapshots trained model, kernel [0,0]
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelAnalysisInitial" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-week3data250kernel1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week3data250kernel1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week3/250Filter0kernel1.png" class="img-fluid figure-img" data-ref-parent="fig-kernelAnalysisInitial">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week3data250kernel1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) 250 snapshots trained model, kernel [0,1]
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelAnalysisInitial" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-week3data250kernel2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week3data250kernel2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week3/250Filter0kernel2.png" class="img-fluid figure-img" data-ref-parent="fig-kernelAnalysisInitial">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week3data250kernel2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) 250 snapshots trained model, kernel [0,2]
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelAnalysisInitial" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-week3data500kernel0" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week3data500kernel0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week3/500Filter0kernel0.png" class="img-fluid figure-img" data-ref-parent="fig-kernelAnalysisInitial">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week3data500kernel0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) 500 snapshots trained model, kernel [0,0]
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelAnalysisInitial" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-week3data500kernel1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week3data500kernel1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week3/500Filter0kernel1.png" class="img-fluid figure-img" data-ref-parent="fig-kernelAnalysisInitial">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week3data500kernel1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(e) 500 snapshots trained model, kernel [0,1]
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelAnalysisInitial" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-week3data500kernel2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week3data500kernel2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week3/500Filter0kernel2.png" class="img-fluid figure-img" data-ref-parent="fig-kernelAnalysisInitial">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week3data500kernel2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(f) 500 snapshots trained model, kernel [0,2]
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelAnalysisInitial" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-week3data750kernel0" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week3data750kernel0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week3/750Filter0kernel0.png" class="img-fluid figure-img" data-ref-parent="fig-kernelAnalysisInitial">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week3data750kernel0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(g) 750 snapshots trained model, kernel [0,0]
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelAnalysisInitial" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-week3data750kernel1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week3data750kernel1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week3/750Filter0kernel1.png" class="img-fluid figure-img" data-ref-parent="fig-kernelAnalysisInitial">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week3data750kernel1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(h) 750 snapshots trained model, kernel [0,1]
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelAnalysisInitial" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-week3data750kernel2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week3data750kernel2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week3/750Filter0kernel2.png" class="img-fluid figure-img" data-ref-parent="fig-kernelAnalysisInitial">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week3data750kernel2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(i) 750 snapshots trained model, kernel [0,2]
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelAnalysisInitial" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-week3data1000kernel0" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week3data1000kernel0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week3/1000Filter0kernel0.png" class="img-fluid figure-img" data-ref-parent="fig-kernelAnalysisInitial">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week3data1000kernel0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(j) 1000 snapshots trained model, kernel [0,0]
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelAnalysisInitial" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-week3data1000kernel1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week3data1000kernel1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week3/1000Filter0kernel1.png" class="img-fluid figure-img" data-ref-parent="fig-kernelAnalysisInitial">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week3data1000kernel1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(k) 1000 snapshots trained model, kernel [0,1]
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelAnalysisInitial" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-week3data1000kernel2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week3data1000kernel2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week3/1000Filter0kernel2.png" class="img-fluid figure-img" data-ref-parent="fig-kernelAnalysisInitial">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week3data1000kernel2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(l) 1000 snapshots trained model, kernel [0,2]
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelAnalysisInitial" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-week3data1250kernel0" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week3data1250kernel0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week3/1250Filter0kernel0.png" class="img-fluid figure-img" data-ref-parent="fig-kernelAnalysisInitial">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week3data1250kernel0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(m) 1250 snapshots trained model, kernel [0,0]
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelAnalysisInitial" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-week3data1250kernel1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week3data1250kernel1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week3/1250Filter0kernel1.png" class="img-fluid figure-img" data-ref-parent="fig-kernelAnalysisInitial">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week3data1250kernel1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(n) 1250 snapshots trained model, kernel [0,1]
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelAnalysisInitial" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-week3data1250kernel2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week3data1250kernel2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week3/1250Filter0kernel2.png" class="img-fluid figure-img" data-ref-parent="fig-kernelAnalysisInitial">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week3data1250kernel2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(o) 1250 snapshots trained model, kernel [0,2]
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kernelAnalysisInitial-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Comparison of the first layer of kernels for each model trained on different amounts of data.
</figcaption>
</figure>
</div>
<hr>
</section>
<section id="week-4" class="level2">
<h2 class="anchored" data-anchor-id="week-4">Week 4</h2>
<p>The work from week 3 to 4 was to use a datset of image filter matrices and compare them to the kernels generated by our model to see if the neural network had learned the filtes without their input. This would show the model to be doing edge analysis for example if it predominantly used edge analysis filters. To do this, edge_filter.ipynb was crated and contains the relevant code to perform this. At this point a few kernels and filters appeared relatively similar but with a few key differences such as one matrix element much larger than in the filter.</p>
<div id="ad0fc154" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skimage <span class="im">import</span> filters</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> normalize </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> <span class="st">"week1/0.1_full"</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> tf.keras.models.load_model(<span class="ss">f'../models/</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">.keras'</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>kernels, biases <span class="op">=</span> model.layers[<span class="dv">0</span>].get_weights()</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Get filters</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>I <span class="op">=</span> np.zeros((<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>I[<span class="dv">1</span>,<span class="dv">1</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>my_filter_dict <span class="op">=</span> {}</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> <span class="va">False</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> f <span class="kw">in</span> <span class="bu">dir</span>(filters):</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> f <span class="op">!=</span> <span class="st">"try_all_threshold"</span>:   <span class="co"># This one causes some to be drawn and just calls the other thresholds which are already checked</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">filter</span> <span class="op">=</span> <span class="bu">eval</span>(<span class="ss">f"filters.</span><span class="sc">{</span>f<span class="sc">}</span><span class="ss">(I)"</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">filter</span>.shape <span class="op">==</span> (<span class="dv">3</span>,<span class="dv">3</span>):</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>            my_filter_dict[f] <span class="op">=</span> <span class="bu">filter</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> plot:</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>                plt.matshow(<span class="bu">filter</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>                plt.title(f)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                plt.figure()</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(f,"with exception", e)</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>      f <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalise matrices</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>normalised_kernels <span class="op">=</span> np.copy(kernels)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>normalised_filters <span class="op">=</span> my_filter_dict.copy()</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> kernel <span class="kw">in</span> normalised_kernels:</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    kernel <span class="op">=</span> (kernel <span class="op">-</span> kernel.<span class="bu">min</span>())</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    kernel <span class="op">=</span> kernel<span class="op">/</span>kernel.<span class="bu">max</span>()</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    kernel <span class="op">/=</span> kernel.<span class="bu">sum</span>()</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    normalised_kernels[index] <span class="op">=</span> kernel</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    index <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>filter_keys <span class="op">=</span> <span class="bu">list</span>(normalised_filters.keys())</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">filter</span> <span class="kw">in</span> normalised_filters.values():</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    filter_key <span class="op">=</span> filter_keys[index]</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">filter</span> <span class="op">=</span> (<span class="bu">filter</span> <span class="op">-</span> <span class="bu">filter</span>.<span class="bu">min</span>())</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Some filters have all the same value so doing this causes divide by zero error, instead set all to 1.</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="bu">filter</span>.<span class="bu">max</span>() <span class="op">==</span> <span class="bu">filter</span>.<span class="bu">min</span>()):</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">filter</span>.fill(<span class="dv">1</span>)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        <span class="bu">filter</span> <span class="op">=</span> <span class="bu">filter</span><span class="op">/</span><span class="bu">filter</span>.<span class="bu">max</span>()</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="bu">filter</span> <span class="op">/=</span> <span class="bu">filter</span>.<span class="bu">sum</span>()</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    normalised_filters[filter_key] <span class="op">=</span> <span class="bu">filter</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    index <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="co">## Compare Matrices:</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>differences_dict <span class="op">=</span> {}</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>kernel_index <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> kernel <span class="kw">in</span> normalised_kernels:</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    kernel <span class="op">=</span> kernel.squeeze()</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    filter_index <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">filter</span> <span class="kw">in</span> normalised_filters.values():</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>        filter_key <span class="op">=</span> <span class="bu">list</span>(my_filter_dict.keys())[filter_index]</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> roll <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">4</span>):   <span class="co"># All 4 rotations</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>            <span class="bu">sum</span> <span class="op">=</span> np.<span class="bu">sum</span>(np.<span class="bu">abs</span>(kernel <span class="op">-</span> <span class="bu">filter</span>))</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>            differences_dict[<span class="ss">f"kernel-</span><span class="sc">{</span>kernel_index<span class="sc">}</span><span class="ss">,filter-</span><span class="sc">{</span>filter_key<span class="sc">}</span><span class="ss">,roll-</span><span class="sc">{</span>roll<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> (<span class="bu">sum</span>)</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>            kernel <span class="op">=</span> np.array(<span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>kernel))[::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>        filter_index <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    kernel_index <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="co"># sort by value</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>sorted_differences_dict <span class="op">=</span> {k: v <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">sorted</span>(differences_dict.items(), key<span class="op">=</span><span class="kw">lambda</span> item: item[<span class="dv">1</span>])} </span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>plt.plot(sorted_differences_dict.values(),<span class="st">'.'</span>)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Index of similarity"</span>)</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Sum of differences between matrices"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/japlin/.pyenv/versions/3.12.4/lib/python3.12/site-packages/skimage/filters/_gabor.py:88: RuntimeWarning:

divide by zero encountered in divide

/Users/japlin/.pyenv/versions/3.12.4/lib/python3.12/site-packages/skimage/filters/_gabor.py:90: RuntimeWarning:

divide by zero encountered in divide

/Users/japlin/.pyenv/versions/3.12.4/lib/python3.12/site-packages/skimage/filters/_gabor.py:97: RuntimeWarning:

invalid value encountered in multiply
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Text(0, 0.5, 'Sum of differences between matrices')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weeklyWorkKernels_files/figure-html/cell-2-output-3.png" width="597" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The values on the lowest end are the kernels and filters have the closest values to.</p>
<div id="af0ea938" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>closest_key <span class="op">=</span> <span class="bu">list</span>(sorted_differences_dict.keys())[<span class="dv">0</span>]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>closest_value <span class="op">=</span> sorted_differences_dict[closest_key]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Closest Key is "</span> <span class="op">+</span> <span class="bu">str</span>(closest_key) <span class="op">+</span> <span class="st">" with a total difference of "</span> <span class="op">+</span> <span class="bu">str</span>(closest_value))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>kernel <span class="op">=</span> normalised_kernels[<span class="dv">0</span>].squeeze()</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>plt.matshow(kernel, cmap<span class="op">=</span><span class="st">"binary"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>plt.matshow(normalised_filters[<span class="st">'farid'</span>], cmap<span class="op">=</span><span class="st">'binary'</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Closest Key is kernel-0,filter-farid,roll-0 with a total difference of 0.1728232986221629</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weeklyWorkKernels_files/figure-html/cell-3-output-2.png" width="411" height="399" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weeklyWorkKernels_files/figure-html/cell-3-output-3.png" width="411" height="399" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>However, also of interest is the values that are furthest from each other as shown here:</p>
<div id="d2713be5" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>furthest_key <span class="op">=</span> <span class="bu">list</span>(sorted_differences_dict.keys())[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>furthest_value <span class="op">=</span> sorted_differences_dict[furthest_key]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Furthest Key is "</span> <span class="op">+</span> <span class="bu">str</span>(furthest_key) <span class="op">+</span> <span class="st">" with a total difference of "</span> <span class="op">+</span> <span class="bu">str</span>(furthest_value))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>kernel <span class="op">=</span> normalised_kernels[<span class="dv">0</span>].squeeze()</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):  <span class="co"># Need to roll 3 times</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    kernel <span class="op">=</span> np.array(<span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>kernel))[::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>plt.matshow(kernel, cmap<span class="op">=</span><span class="st">"binary"</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>plt.matshow(normalised_filters[<span class="st">'unsharp_mask'</span>], cmap<span class="op">=</span><span class="st">'binary'</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Furthest Key is kernel-0,filter-unsharp_mask,roll-3 with a total difference of 1.9999999850988388</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weeklyWorkKernels_files/figure-html/cell-4-output-2.png" width="411" height="399" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weeklyWorkKernels_files/figure-html/cell-4-output-3.png" width="402" height="404" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Here we have basically the complete opposite filter has appeared. There are other results that we could look into as well, such as finding which filtrer is closest to each kernel:</p>
<div id="1cc58a64" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>name0 <span class="op">=</span> <span class="st">'kernel-0'</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>name1 <span class="op">=</span> <span class="st">'kernel-1'</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>name2 <span class="op">=</span> <span class="st">'kernel-2'</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>kernel_0_dict <span class="op">=</span> {}</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>kernel_1_dict <span class="op">=</span> {}</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>kernel_2_dict <span class="op">=</span> {}</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> f <span class="kw">in</span> sorted_differences_dict.keys():</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> name0 <span class="kw">in</span> f:</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        kernel_0_dict[f]<span class="op">=</span>sorted_differences_dict[f]</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> name1 <span class="kw">in</span> f:</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        kernel_1_dict[f]<span class="op">=</span>sorted_differences_dict[f]</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> name2 <span class="kw">in</span> f:</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        kernel_2_dict[f]<span class="op">=</span>sorted_differences_dict[f]</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>closest_key <span class="op">=</span> <span class="bu">list</span>(kernel_1_dict.keys())[<span class="dv">0</span>]</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>closest_value <span class="op">=</span> kernel_1_dict[closest_key]</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Closest key for kernel 1 is "</span> <span class="op">+</span> <span class="bu">str</span>(closest_key) <span class="op">+</span> <span class="st">" with a total difference of "</span> <span class="op">+</span> <span class="bu">str</span>(closest_value))</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>kernel <span class="op">=</span> normalised_kernels[<span class="dv">1</span>].squeeze()</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):  <span class="co"># Need to roll 3 times</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    kernel <span class="op">=</span> np.array(<span class="bu">list</span>(<span class="bu">zip</span>(<span class="op">*</span>kernel))[::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>plt.matshow(kernel, cmap<span class="op">=</span><span class="st">"binary"</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>plt.matshow(normalised_filters[<span class="st">'scharr_h'</span>], cmap<span class="op">=</span><span class="st">'binary'</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Closest key for kernel 1 is kernel-1,filter-scharr_h,roll-3 with a total difference of 0.303121835572852</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weeklyWorkKernels_files/figure-html/cell-5-output-2.png" width="411" height="399" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weeklyWorkKernels_files/figure-html/cell-5-output-3.png" width="419" height="399" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="week-6" class="level2">
<h2 class="anchored" data-anchor-id="week-6">Week 6</h2>
<p>Kernal analysis has been a bit abandonded but we now have similar work after attempting to create an autoencoder. We want to go through each step of the model and understand what the model is seeing so i will do each step of the model one at a time, inspect the kernels and an example input image compared to itâ€™s output. For speed we will use the 500 images set to train the model each time, but with reduced layers it should be faster anyway. With on eof these sets we have 6000 training samples and 1000 test samples. The first breakdown will just look at the first layer:</p>
<div id="56cb5ca1" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_model(shape):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Sequential()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(filters<span class="op">=</span><span class="dv">3</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>,<span class="dv">3</span>), padding<span class="op">=</span><span class="st">'same'</span>, strides<span class="op">=</span>(<span class="dv">3</span>,<span class="dv">3</span>), activation<span class="op">=</span><span class="st">'relu'</span>, input_shape<span class="op">=</span>shape))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model.add(BatchNormalization())</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Because the validation set is simply the tumbling rate, a single value and we are outputting larger images we cant train the model, but we can see what the layers are calculating and hence cannot train the model and therefore look at kernels. The results of this are in</p>
<div id="fig-modelBreakdown1" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-modelBreakdown1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-modelBreakdown1" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-week6InputImage" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6InputImage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/inputImage.png" class="img-fluid figure-img" data-ref-parent="fig-modelBreakdown1">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6InputImage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Example input image.
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-modelBreakdown1" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-week6FirstLayer" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6FirstLayer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/firstLayer.png" class="img-fluid figure-img" data-ref-parent="fig-modelBreakdown1">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6FirstLayer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Prediction of example image.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-modelBreakdown1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2
</figcaption>
</figure>
</div>
<p>The input shape of an image was 128,128,1 and the ouput here is 43,43,3. This means for each pixel there are now 3 values which when plotted are interpreted as an RGB value. Hence, the red pixels are high in the first value, green high in the second value and blue high in the third. The brighter, the higher this value.</p>
<p>Now we add another layer as follows:</p>
<div id="f5cf8c09" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_model(shape):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Sequential()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(filters<span class="op">=</span><span class="dv">3</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>,<span class="dv">3</span>), padding<span class="op">=</span><span class="st">'same'</span>, strides<span class="op">=</span>(<span class="dv">3</span>,<span class="dv">3</span>), activation<span class="op">=</span><span class="st">'relu'</span>, input_shape<span class="op">=</span>shape))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    model.add(BatchNormalization())</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(filters<span class="op">=</span><span class="dv">3</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>,<span class="dv">3</span>), padding<span class="op">=</span><span class="st">'same'</span>))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    model.add(BatchNormalization())</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-modelBreakdown2" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-modelBreakdown2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-modelBreakdown2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-week6InputImage" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6InputImage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/inputImage.png" class="img-fluid figure-img" data-ref-parent="fig-modelBreakdown2">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6InputImage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Example input image.
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-modelBreakdown2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-week6SecondLayer" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6SecondLayer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/secondLayer.png" class="img-fluid figure-img" data-ref-parent="fig-modelBreakdown2">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6SecondLayer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Prediction of example image.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-modelBreakdown2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3
</figcaption>
</figure>
</div>
<p>This can be done to further layers but becomes a lot of white noise. The reason for htis is that these two layers are actually also basically just random as they are untrained predictions, so not actually â€˜seeingâ€™ anything, but it is at least performing their operations randomly on the input image.</p>
<hr>
<p>After that failed attempt we have new ideas. Firstly we can compare kernels of a model trained on rolling to one with no rolling. There may be that the no rolling version looks for different patterns. Eaily we cna simply comapre if the kernels are closer to the filters by plotting their difference scores:</p>
<div id="fig-kernelFilterDifferences" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kernelFilterDifferences-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelFilterDifferences" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-week6KernelFilterComparisonRolling" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6KernelFilterComparisonRolling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/rollingKernelDifferences.png" class="img-fluid figure-img" data-ref-parent="fig-kernelFilterDifferences">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6KernelFilterComparisonRolling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Model trained on rolling dataâ€™s kernels compared to known filters. The lower the y axis value, the closer they are to each other.
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelFilterDifferences" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-week6KernelFilterComparisonNoRolling" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6KernelFilterComparisonNoRolling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/noRollingKernelDifferences.png" class="img-fluid figure-img" data-ref-parent="fig-kernelFilterDifferences">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6KernelFilterComparisonNoRolling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Model trained on non rolling dataâ€™s kernels compared to known filters. The lower the y axis value, the closer they are to each other.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-kernelFilterDifferences-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4
</figcaption>
</figure>
</div>
<p>The filters that match the rolling data closest are show below:</p>
<div id="fig-kernelFilterDifferences" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kernelFilterDifferences-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelFilterDifferences" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-week6KernelFiltersRolling" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6KernelFiltersRolling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/rollingDataClosestFilters.png" class="img-fluid figure-img" data-ref-parent="fig-kernelFilterDifferences">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6KernelFiltersRolling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Model trained on rolling dataâ€™s kernel matrices that match known filters best.
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernelFilterDifferences" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-week6KernelFiltersNoRolling" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6KernelFiltersNoRolling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/noRollingDataClosestFilters.png" class="img-fluid figure-img" data-ref-parent="fig-kernelFilterDifferences">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6KernelFiltersNoRolling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Model trained on non rolling dataâ€™s kernel matrices that match known filters best.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-kernelFilterDifferences-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5
</figcaption>
</figure>
</div>
<p>The mean differences for filters 0,1 and 2 respectively are 0.7356, 0.79468 and 0.81113 for rolling data and for non rolling the means are 0.85678, 0.7939 and 0.7509. So for rolling data trained model the first kernel was closest to filters and kernel 2 was closest for rolling data, hence why they are compared in <a href="#fig-kernelFilterDifferences" class="quarto-xref">Figure&nbsp;5</a>. This shows that mostly the most important parts the kernels are looking at are similar between the rolling and no rolling data.</p>
<div id="fig-week6AllKernels" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-week6AllKernels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-week6AllKernels" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-week6RollingAll3Kernels" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6RollingAll3Kernels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/rollingAll3Kernels.png" class="img-fluid figure-img" data-ref-parent="fig-week6AllKernels">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6RollingAll3Kernels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Model trained on rolling dataâ€™s kernel matrices.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-week6AllKernels" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-week6NoRollingAll3Kernels" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6NoRollingAll3Kernels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/noRollingAll3Kernels.png" class="img-fluid figure-img" data-ref-parent="fig-week6AllKernels">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6NoRollingAll3Kernels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Model trained on non rolling dataâ€™s kernel matrices.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-week6AllKernels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6
</figcaption>
</figure>
</div>
<hr>
<p>Now we can move onto a method of looking at what the model outputs in intermediate layers from a enw method. Again, the outputâ€™s shape are 43x43x3 so the image output will be made of 3 vlaues and interpreted as an RGB value, so the more red, the higher the importance of the first value and so on. Here are the rsults of an example frame that features some percolation with a true tumbling rate of 0.023 and predicted of 0.065.</p>
<div id="fig-modelBreakdown" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-modelBreakdown-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-modelBreakdown" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-week6ExampleInputFrame" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6ExampleInputFrame-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/exampleInputFrame.png" class="img-fluid figure-img" data-ref-parent="fig-modelBreakdown">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6ExampleInputFrame-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Image of input frame for trained model.
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-modelBreakdown" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-week6FirstLayerFrame" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6FirstLayerFrame-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/firstLayerOutput.png" class="img-fluid figure-img" data-ref-parent="fig-modelBreakdown">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6FirstLayerFrame-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Image of output by first layer, the 2d convolution.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-modelBreakdown" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-week6SecondLayerFrame" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6SecondLayerFrame-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/secondLayerOutput.png" class="img-fluid figure-img" data-ref-parent="fig-modelBreakdown">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6SecondLayerFrame-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Image of output by second layer, the batch normalisation.
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-modelBreakdown" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-week6ThirdLayerFrame" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6ThirdLayerFrame-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/thirdLayerOutput.png" class="img-fluid figure-img" data-ref-parent="fig-modelBreakdown">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6ThirdLayerFrame-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) Image of output by third layer, the second 2d convolution.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-modelBreakdown" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-week6FourthLayerFrame" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6FourthLayerFrame-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/fourthLayerOutput.png" class="img-fluid figure-img" data-ref-parent="fig-modelBreakdown">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6FourthLayerFrame-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(e) Image of output by fourth layer, the second batch normalisation.
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-modelBreakdown" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-week6FifthLayerFrame" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6FifthLayerFrame-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/fifthLayerOutput.png" class="img-fluid figure-img" data-ref-parent="fig-modelBreakdown">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6FifthLayerFrame-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(f) Image of output by fifth layer, the max 2d pooling.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-modelBreakdown" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-week6SizthLayerFrame" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6SizthLayerFrame-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/sixthLayerOutput.png" class="img-fluid figure-img" data-ref-parent="fig-modelBreakdown">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6SizthLayerFrame-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(g) Image of output by sixth layer, the average pooling 2d.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-modelBreakdown-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7
</figcaption>
</figure>
</div>
<hr>
<p>After a talk I realised the image is each created by each filter, so we can compare the original image to the kernels and then their output:</p>
<div id="fig-modelBreakdownNew" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-modelBreakdownNew-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-modelBreakdownNew" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-week6ExampleInputFrameNew" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6ExampleInputFrameNew-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/exampleInputFrameNew.png" class="img-fluid figure-img" data-ref-parent="fig-modelBreakdownNew">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6ExampleInputFrameNew-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Image of input frame for trained model.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-modelBreakdownNew" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-week6FirstLayerFrameNew" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6FirstLayerFrameNew-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/firstLayerOutputNew.png" class="img-fluid figure-img" data-ref-parent="fig-modelBreakdownNew">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6FirstLayerFrameNew-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Image of output by first layer, the 2d convolution.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-modelBreakdownNew" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-week6ThirdLayerFrameNew" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-week6ThirdLayerFrameNew-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/week6/thirdLayerOutputNew.png" class="img-fluid figure-img" data-ref-parent="fig-modelBreakdownNew">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-week6ThirdLayerFrameNew-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Image of output by third layer, the second 2d convolution.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-modelBreakdownNew-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8
</figcaption>
</figure>
</div>
<p>Here Iâ€™ve included less layers as the kernels that generate them ebcome less trivial as shown by <a href="#fig-week6ThirdLayerFrameNew" class="quarto-xref">Figure&nbsp;8 (c)</a> where all three kernels that generate the output are used as before in an RGB result (i.e.&nbsp;there are 9 kernels in this layer).</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>